(this["webpackJsonpwebp-helper"]=this["webpackJsonpwebp-helper"]||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(7),i=n.n(o),c=(n(13),n(3)),s=n(1),u=n.n(s),l=n(2),f=(n(15),n(4)),p=n(5);function d(e){var t=document.createElement("script");t.type="text/javascript",t.src=e;var n=new Promise((function(e){return t.onload=e}));return document.body.appendChild(t),n}self.Module="undefined"!==typeof self.Module?self.Module:{};var h,m=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,null,[{key:"encode",value:function(e){var t=e.width%4,n=3*(e.height*(3*e.width+t))+54,r=new DataView(new ArrayBuffer(n));r.setUint8(0,"B".charCodeAt(0)),r.setUint8(1,"M".charCodeAt(0)),r.setUint32(2,n,!0),r.setUint32(6,0,!0),r.setUint32(10,54,!0);r.setUint32(14,40,!0),r.setUint32(18,e.width,!0),r.setUint32(22,e.height,!0),r.setUint16(26,1,!0),r.setUint16(28,24,!0),r.setUint32(30,0,!0),r.setUint32(34,0,!0),r.setUint32(38,0,!0),r.setUint32(42,0,!0),r.setUint32(46,0,!0),r.setUint32(50,0,!0);for(var a=4*Math.floor((24*e.width+31)/32),o=0,i=e.height-1;i>=0;i--){for(var c=0;c<e.width;c++){var s=54+i*a+3*c;r.setUint8(s+2,e.data[o++],!0),r.setUint8(s+1,e.data[o++],!0),r.setUint8(s,e.data[o++],!0),e.rgb||o++}var u=54+i*a+3*e.width;switch(t){case 3:r.setUint8(u,0,!0);case 2:r.setUint8(u+1,0,!0);case 1:r.setUint8(u+2,0,!0)}}return new Blob([r],{type:"image/bmp"})}}]),e}();function v(){return b.apply(this,arguments)}function b(){return(b=Object(l.a)(u.a.mark((function e(){var t,n,r,a,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Promise((function(e){self.Module.onRuntimeInitialized=e})),!self||!self.document){e.next=6;break}return e.next=4,d("./webp_wasm.js");case 4:e.next=7;break;case 6:self&&self.importScripts?importScripts("./webp_wasm.js"):console.warning("Cannot auto import 'webp_wasm.js' from script imported from worker");case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))(),e.next=3,t;case 3:return n=Module.cwrap("version","number",[]),r=Module.cwrap("getInfo","number",["number","number"]),a=Module.cwrap("decode","number",["number","number"]),o=function(){function e(t){Object(f.a)(this,e),this.size=t.byteLength,this.ptr=Module._malloc(this.size),Module.HEAPU8.set(new Uint8Array(t),this.ptr)}return Object(p.a)(e,[{key:"version",value:function(){return n()}},{key:"info",value:function(){var e=r(this.ptr,this.size);if(!!!Module.getValue(e,"i32"))return Module._free(e),{width:null,height:null};var t=Module.getValue(e+4,"i32"),n=Module.getValue(e+8,"i32");return Module._free(e),{width:t,height:n}}},{key:"decode",value:function(){var e=this.info(),t=e.width,n=e.height,r=a(this.ptr,this.size),o=new Uint8Array(Module.HEAPU8.buffer,r,t*n*4),i=new Uint8ClampedArray(o);return Module._free(r),i}},{key:"decodeToBMP",value:function(){var e=this.info(),t=e.width,n=e.height,r=this.decode(),a=new ImageData(r,t,n);return m.encode(a)}},{key:"decodeToBlob",value:function(e,t){var n=this.info(),r=n.width,a=n.height,o=this.decode(),i=new ImageData(o,r,a);e.width=r,e.height=a,e.getContext("2d").putImageData(i,0,0);var c="image/png";return t&&(c="image/jpeg"),"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?e.convertToBlob?e.convertToBlob({type:c,quality:1}):e.toBlob(c,1):new Promise((function(t){e.toBlob((function(e){return t(e)}))}))}}]),e}(),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=!1,g=function(){var e=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"===typeof t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,new Promise((function(e){var n=setInterval((function(){t()&&(clearInterval(n),e())}),20)}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w){e.next=4;break}return e.next=3,g((function(){return"undefined"!==typeof h}));case 3:return e.abrupt("return",h);case 4:if(h){e.next=10;break}return w=!0,e.next=8,v();case 8:h=e.sent,w=!1;case 10:return e.abrupt("return",h);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();k();var y=/webp$/,E=function(){var e=Object(l.a)(u.a.mark((function e(t,n){var r,a,o,i,c,s,l,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name.replace(y,n?"jpg":"png"),e.next=3,t.arrayBuffer();case 3:return a=e.sent,e.next=6,k();case 6:return o=e.sent,i=new o(a),c=document.createElement("canvas"),e.next=11,i.decodeToBlob(c,!1);case 11:s=e.sent,l=document.createElement("a"),f=l.href=URL.createObjectURL(s),l.download=r,l.className="hide",l.innerText="\u4e0b\u8f7d\u6587\u4ef6",document.body.appendChild(l),l.click(),setTimeout((function(){URL.revokeObjectURL(f)}),100);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var j=function(){var e=Object(r.useState)(!1),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(!1),s=Object(c.a)(i,2),f=s[0],p=s[1],d=Object(r.useState)(!1),h=Object(c.a)(d,2),m=h[0],v=h[1],b=function(){o(!1),p(!1)},w=Object(r.useCallback)((function(e){f||p(!0),n&&(event.dataTransfer.dropEffect="none"),e.stopPropagation(),e.preventDefault()}),[f,n]),g=Object(r.useCallback)((function(e){var t=Array.from(e.dataTransfer.files);if(t=t.filter((function(e){return"image/webp"===e.type})),b(),t&&t.length)for(var n=0;n<t.length;n++)E(t[n],m);e.stopPropagation(),e.preventDefault()}),[m]),k=function(e){console.log(e)},y=Object(r.useCallback)((function(){v(!m)}),[m]),j=Object(r.useRef)(null),U=Object(r.useCallback)((function(e){switch(e.type){case"dragleave":j.current===e.target&&b();break;case"dragenter":f||p(!0),j.current=e.target}e.stopPropagation(),e.preventDefault()}),[f]);Object(r.useEffect)((function(){var e=document;return e.addEventListener("dragenter",U),e.addEventListener("dragover",w),e.addEventListener("dragleave",U),e.addEventListener("drop",g),e.addEventListener("keypress",k),function(){e.removeEventListener("dragenter",U),e.removeEventListener("dragover",w),e.removeEventListener("dragleave",U),e.removeEventListener("drop",g),e.removeEventListener("keypress",k)}}),[w,g,U]);var O=Object(r.useCallback)(function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Array.from(t.target.files),t.target.value="",b(),n&&n.length)for(r=0;r<n.length;r++)E(n[r],m);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[m]),x="item "+(m?"clickable":"link"),C="item "+(m?"link":"clickable");return a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("div",{className:"App-logo",title:"\u4f60\u7785\u5565\uff1f"},"WebP Helper"),f&&a.a.createElement("div",{className:"drop-mask"},a.a.createElement("p",null,"\u677e\u5f00\u9f20\u6807\u540e\uff0c\u62d6\u52a8\u7684\u6587\u4ef6\u5c06\u4f1a\u88ab\u8f6c\u6362\uff0c\u6309 ESC \u952e\u53d6\u6d88"),a.a.createElement("p",null,a.a.createElement("span",{className:"link",onMouseDown:b},"\u77e5\u9053\u4e86"))),a.a.createElement("p",null,a.a.createElement("code",null,"\u62d6\u52a8 *.webp \u6587\u4ef6\u5230\u6b64\u9875\u9762")),a.a.createElement("p",null,"\u6216"),a.a.createElement("p",null,a.a.createElement("input",{id:"select-file",type:"file",multiple:!0,onChange:O,accept:".webp",hidden:!0}),a.a.createElement("label",{className:"btn",htmlFor:"select-file"},"\u9009\u62e9 *.webp \u6587\u4ef6")),a.a.createElement("p",{className:"hover-effect"},"\u8f6c\u6362\u4e3a ",a.a.createElement("span",{title:"\u70b9\u51fb\u5207\u6362\u683c\u5f0f",className:x,onClick:m?y:void 0},"*.png"),"  ",a.a.createElement("span",{title:"\u70b9\u51fb\u5207\u6362\u683c\u5f0f",className:C,onClick:m?void 0:y},"*.jpg"),"  \u683c\u5f0f")),a.a.createElement("footer",null,a.a.createElement("p",null,a.a.createElement("small",null,"webp_wasm\u6765\u81ea",a.a.createElement("a",{href:"https://github.com/kenchris/wasm-webp"},"kenchris/wasm-webp")))),a.a.createElement("a",{className:"github-fork-ribbon",href:"http://url.to-your.repo","data-ribbon":"Fork me on GitHub",title:"Fork me on GitHub"},"Fork me on GitHub"))},U=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function O(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(a.a.createElement(j,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/webp-helper",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/webp-helper","/service-worker.js");U?(!function(e,t){fetch(e).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):O(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):O(t,e)}))}}()},8:function(e,t,n){e.exports=n(16)}},[[8,1,2]]]);
//# sourceMappingURL=main.d853e18f.chunk.js.map